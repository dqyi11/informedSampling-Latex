%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%2345678901234567890123456789012345678901234567890123456789012345678901234567890
%        1         2         3         4         5         6         7         8

\documentclass[letterpaper, 10 pt, conference]{ieeeconf}  % Comment this line out if you need a4paper

%\documentclass[a4paper, 10pt, conference]{ieeeconf}      % Use this line for a4 paper

\IEEEoverridecommandlockouts                              % This command is only needed if 
                                                          % you want to use the \thanks command

\overrideIEEEmargins                                      % Needed to meet printer requirements.

% See the \addtolength command later in the file to balance the column lengths
% on the last page of the document

\makeatletter
\let\NAT@parse\undefined
\makeatother

\usepackage{xspace}
\usepackage{amsmath,amssymb,amsfonts,amsfonts}
\usepackage{algorithm}
\usepackage[noend]{algorithmic}
\usepackage{url}
\usepackage{bm}
\usepackage{graphicx,subfigure}
\usepackage{color}
\usepackage{hyperref}
%\hypersetup{bookmarksopen,
%bookmarksnumbered,
%pdfpagemode=UseOutlines,
%colorlinks=true,
%linkcolor=blue,
%anchorcolor=blue,
%citecolor=blue,
%filecolor=blue,
%menucolor=blue,
%urlcolor=blue
%}


\title{\LARGE \bf
Informed sampling by Markov Chain Monte Carlo methods
}


\author{
Rohan Thakker$^{*}$,
Cole Gulino$^{*}$,
Daqing YI$^{}$,
Oren Salzman$^{}$ and
Siddhartha Srinivasa$^{}$% <-this % stops a space
\thanks{*R. Thakker and C. Gulino contributed equally to this paper.}
\thanks{This work was (partially) funded by the National Science Foundation IIS (\#1409003), Toyota Motor Engineering \& Manufacturing (TEMA), and the Office of Naval Research.}% <-this % stops a space
\thanks{$^{1}${\tt\small \{rthakker, cgulino, daqingy, osalzman, ss5\} @andrew.cmu.edu}}%
%
\\        
Robotics Institute, Carnegie Mellon University$^{1}$
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  macros 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{macros.tex}

\begin{document}



\maketitle
\thispagestyle{empty}
\pagestyle{empty}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}

\end{abstract}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
\label{sec:intro}

Sampling-based motion-planning algorithms~\cite{CBHKKLT05, L06} have proven to be an effective tool at solving motion-planning problems.
They search through a continuous state space~$\calX$ by sampling random states and maintaining a discrete graph~$G$ called a \emph{roadmap}.
Vertices and edges in $G$ correspond to collision-free states and paths, respectively.

Roughly speaking, these algorithms iteratively sample new states.
This is required to ensure that, as the number of samples tends to infinity, 
(i)~a solution will be found 
(a property called \emph{probabilistic completeness})
and that
(ii)~given some optimization criteria, the quality of the solution will progressively converge to the quality of the optimal solution
(a property called \emph{asymptotic  optimality}).

In the initial stages of the algorithm, 
when no path has yet to be found, 
the samples need to be drawn from the entire state space~$\calX$.
However, once a path $\gamma$ is produce,  algorithm that seek \emph{high-quality paths} can limit their sampling domain to a subset of~$\calX$  containing states that may produce higher-quality paths than $\gamma$.
Following Gammell et al.~\cite{GSB14}, we call this subset the \emph{informed subset} and denote it $\Cinf$.

For Euclidean spaces optimizing for path length, 
\Cinf can be analytically expresses as a prolate hyperspheroid and can be sampled directly~\cite{GSB14}.
Indeed, directly sampling in \Cinf has been shown to dramatically improve computation time when compared to sampling in $\calX$, especially in high dimensions. 

Unfortunately, in more general settings such as
for systems with differential constraints,
it is not clear how to directly sample \Cinf.
%
One approach to produce samples in \Cinf is via \emph{rejection sampling}---sampling a state $x \in \calX$ and testing if $x \in \Cinf$.
However, when the size of the informed space~$\Cinf$ is much smaller than entire state space~$\calX$, then this procedure may dominate the running time of the algorithm~\cite{KTC16}.
Recently, Kunz et al.~\cite{KTC16} showed, under some technical assumptions, how to efficiently produce samples in~$\Cinf$ by \emph{Hierarchical rejection sampling} (HRS). 
Here, individual dimensions are sampled recursively 
and then combined. Rejection sampling is performed for these partial samples until a suitable sample has been produced. The novelty of HRS is the ability to fail fast. 

Unfortunately, both rejection sampling and HRS may produce a large number of rejected samples especially in high-dimensional spaces.
This may cause the search algorithm to spend most of its time trying to produces samples in~$\Cinf$ rather than explore it.
In this paper, we suggest an alternative approach to sampling in the informed set \Cinf for a wide range of settings.
Our main insight is 
\os{this is a very important sentence!!!}
Specifically, our approach consists of two stages:
in the first, a random sample $x \in \calX$ is retracted to the boundary of~$\Cinf$ by running a gradient-descent algorithm;
in the second stage, this retracted sample $\tilde{x}$ is used to seed a Monte Carlo sampling chain which allows us to approximately produce samples uniformly \emph{within}~$\Cinf$.

Our approach requires that the system has a solution to the two-point boundary value problem (2pBVP)~\cite{} and that a gradient can be defined over the cost function.
Indeed, we demonstrate the efficiency of our approach on a wide variety of systems and show that it enables reducing the planning time by several orders of magnitute when compared to algorithms using rejection sampling or HRS.

%While, original sampling-based algorithms such as RRT~\cite{LK01} and PRM~\cite{KSLO96} only guaranteed to asymptotically return \emph{a} solution, if one exists, they did not provide any guarantees on the \emph{quality} of the solution, given some optimization criteria.
%Karaman and Frazzoli~\cite{KF11}, presented variants of PRM and RRT, named PRM* and RRT*, respectively that were shown to produce paths who's cost converges asymptotically to the minimal-cost path.
%Additional algorithms followed, increasing the converges rate by various techniques such as lazy dynamic programming~\cite{GSB15, JSCP15}, relaxing optimality to near-optimality~\cite{DB14, SH16} and more.
%

%In the most basic form, the motion-planning problem calls for computing \emph{a} path between two given states.
%Indeed, 
%However, recent years 
%Original planners such as RRT~\cite{LK01} and PRM~\cite{KSLO96} did not provide any guarantee on the \emph{s}


\section{Related work}
\label{sec:related_work}


\subsection{Planning}


Classic:\\
RRT~\cite{LK01}

PRM~\cite{KSLO96}

AO:\\
RRT*, PRM*~\cite{KF11}

BIT*~\cite{GSB15}

FMT*~\cite{JSCP15}

Near AO:\\
LBT-RRT~\cite{SH16}

SPARSE~\cite{DB14}


RGGS~\cite{SSH16}


Kinodynamic works:\\~\cite{SL14, XBPA15, WB13, KF10}

\subsection{Sampling}

Hierarchical sampling~\cite{KTC16}.

Informed sampling~\cite{GSB14}

OBPRM~\cite{ABDJV98, YTEA12}

Medial axis~\cite{LTA03, YDLTA14}

\os{can our method be applied to produce samples on the medial axis?}

S. A. Wilmarth, N. M. Amato, and P. F. Stiller. MAPRM: A prob-
abilistic roadmap planner with sampling on the medial axis of the
free space. In Proc. IEEE Int. Conf. Robot. Autom. (ICRA), pages
1024–1031, 1999.

S. A. Wilmarth, N. M. Amato, and P. F. Stiller. Motion planning for
a rigid body using random networks on the medial axis of the free
space. In Proc. ACM Symp. on Computational Geometry (SoCG),
pages 173–180, 1999

heuristic~\cite{US03, SWT09}

\subsection{MCMC}

Markov Chain Monte Carlo(MCMC)~\cite{ADDJ03} is a framework of sampling from a given probability distribution by constructing a Markov chain of random transition toward a desired distribution $ \pi (x) $ .
A set of samples are generated to approximate the desired distribution $ \pi (x) $.
Unlike a rejection sampling, MCMC does a random walk in a parametric space and concentrates on an important areas, which usually brings better efficiency.
Hamiltonian Monte Carlo(HMC)~\cite{N11} is introduced to provide better efficiency in converging to a desired distribution.
It adopts physical system dynamics to propose future states in the Markov chain.
The concept origins from Hamiltonian dynamics, which models the movement of an object.
Given the position $ x $ and the momentum $ q $ of an object, the system energy can be written as $ H(x,q) = U(x) + K(q) $, in which $ U(x) $ is the potential energy and $ K(q) $ is the kinetic energy.
The movement of the object (how $ x $ and $ q $ change over time) is determined by
$ \frac{dx}{dt} = \frac{\partial H}{\partial q} $ and $ \frac{dq}{dt} = - \frac{\partial H}{\partial x} $.
By the association between energy and a canonical distribution, a joint distribution for the states $ x $ and $ q $ can be created from a Hamiltonian dynamics, which is 
$ P(x, q) = \frac{1}{Z} \exp ( -H(x,q) / T ) = \frac{1}{Z} \exp ( -U(x) / T) \exp (-K(q) / T) $.
If we define $ U(x) = - \log ( \pi(x) T ) $, $ P(x, q) $ can be rewritten as $ P(x, q) = \pi (x) \frac{1}{Z} \exp (-K(q) / T) $.
Because the state $ x $ and the the momentum  $ q $ are independent, we can sample $ [ x ,q ] $ from $ P(x, q) $ and discard the momentum $ q $ (as an auxiliary variable).
The collected set of $ x $ is equivalent to sampling from $ \pi(x) $.
We are going to integrate this idea into our sampling framework of efficiently generating samples under kinetic constraints. 

\section{Problem definition}
\label{sec:pdef}

\subsection{general}

\subsection{double integrator}
Discuss how the informed set looks like

\section{Algorithm}
\label{sec:algorithm}

Define the dynamics of a robot as 
\begin{equation}
\label{eq:kinematics}
\dot{\bm{x}}(t) = f( \bm{x}(t) , \bm{u}(t) ), 
\end{equation}
in which $ \bm{x} \in \mathcal{X} \subseteq \mathbb{R}^n $ is the state of the robot, and $ \bm{u} \in \mathcal{U} \subseteq \mathbb{R}^m $ is the control input.
The dynamics determines a state trajectory $ \pi $, given a duration $ T $, an initial state $ \bm{x}(0) $ and an initial input $ \bm{u}(0) $.
The cost of a trajectory $ \pi $ is defined as the accumulated cost along the path, which is 
\begin{equation}
\label{eq:path_cost}
c(\pi) = \int_0^{T} c( x(t), u(t) ) dt.
\end{equation}
Consider the obstacles in a workspace, we have $ \mathcal{X}_{free} \subseteq \mathcal{X} $.
Consider the bounds of the control input, we have $ \mathcal{U}_{free} \subseteq \mathcal{U} $.
The dynamics of the robot in Equation~\eqref{eq:kinematics}, free state space $  \mathcal{X}_{free} $ and free control input space $ \mathcal{U}_{free} $ determines a free trajectory space $ \Pi_{free} $, which contains all feasible trajectories $ \pi \in \Pi_{free} $.

We can define an optimal kinodynamic path-planning problem that finds a kinodynamic path minimizing the cost in Definition \ref{defn:optimal_kino_path_planning}.
\begin{defn}{ \textbf{Optimal Kinodynamic Path-Planning} }
\label{defn:optimal_kino_path_planning}
	Find an optimal path $  \pi^* $ that satisfies
	\begin{itemize}
	\item $\forall t \in [0,T] $, $ \bm{x} (t) \in \mathcal{X}_{free}  $ and $ \bm{u} (t) \in \mathcal{U}_{free} $;
	\item $ \bm{x} (0) = x_{init} $, $ \bm{x} (T) = x_{goal} $, $ \bm{u} (0) = u_{init} $ and $ \bm{u} (T) = u_{goal} $; and
	\item $ \pi^* = \max_{ \pi \in \Pi_{free} } c( \pi ) $. 
	\end{itemize}
\end{defn}

\dy{Do we want to set an initial and a goal for the control input? Does this simplify the problem solving?}

\begin{algorithm}
	\begin{algorithmic}[1]
		\STATE
   	\end{algorithmic}
	\caption{MCMC Informed Sampling}
	\label{alg:mcmc_informed_sampling}
\end{algorithm}


\section{Results}


\section{Conclusion}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibliography{bibliography}
\bibliographystyle{IEEEtran}
%\bibliography{IEEEabrv,bibliography}


\end{document}
